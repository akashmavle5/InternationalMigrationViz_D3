
<!DOCTYPE html>
<meta charset="utf-8">
<body>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://d3js.org/topojson.v1.min.js"></script>
  <script src="./js/datamaps.world.min.js?v=1"></script>
  
  <h2>Datamaps Test</h2>
    <label id="testValue">Showing year:</label>
    <br>
    <br>
    
  <button onclick="buttonClick()">testButton1</button>
    
  <input id="testslider" type="range" min="1990" max="2015" value="1990" step="5" />   
  <span id="range">1990</span>
    
  <script type="text/javascript">
    onload = function() {
        var $ = function(id) { return document.getElementById(id); };
        $('testslider').oninput = function() { $('range').innerHTML = this.value; };
        $('testslider').oninput();
    };
    </script>
    
  <div id="wraparoundDiv" style="width:100%;">
      <div id="container1" style="position: left; width: 45%; max-height: 450px; float: left;"></div>
      <div id="divider" style="background-color: aqua; position: left; width:10px; max-height: 450px;"></div>
        
      <div id="container2" style="position: left; width: 45%; max-height: 450px; float: left;"></div>

  </div>
    
  <script>
        var value = 1990;
       //basic map config with custom fills, mercator projection
        var map = new Datamap({
        scope: 'world',
        element: document.getElementById('container1'),
        projection: 'mercator',
        height: 500,
        fills: {
          defaultFill: '#f0af0a',
          lt50: 'rgba(0,244,244,0.9)',
          gt50: 'blue'
        },
          
        geographyConfig: {
         // borderColor: 'red' ,
          highlightBorderColor: '#bada55',
          highlightBorderWidth: 2
        },
        
       /* data: {
          USA: {fillKey: 'lt50'},
          RUS: {fillKey: 'lt50' },
          CAN: {fillKey: 'lt50' },
          BRA: {fillKey: 'gt50' },
          ARG: {fillKey: 'gt50'},
          COL: {fillKey: 'gt50' },
          AUS: {fillKey: 'gt50' },
          ZAF: {fillKey: 'gt50' },
          MAD: {fillKey: 'gt50' }       
        }
        */
      })
      
      var map2 = new Datamap({
        scope: 'world',
        element: document.getElementById('container2'),
        projection: 'mercator',
        height: 500,
        dataUrl: 'data2.csv',
        dataType: 'csv',
        data: {},
        fills: {
        //Use "keyword" from CSV to fill a color
          'Visited': 'blue',
          defaultFill: '#f0af0a'
        },
          
        geographyConfig: {
         popupTemplate: function(geo, data) {
                return data && data.info && "<div class='hoverinfo'><strong>" + data.info + "</strong></div>";
              },    
          highlightBorderColor: '#bada55',
          highlightBorderWidth: 3
        },
        
      })
         
      var testArcs = [];     
         
      //Building the arcs from data
         
      //TODO: Put this in a function, that takes the current year, and
         //loads the correct arc data (from csv file)
         
      d3.csv("data2.csv", function(error, csvdata) {

            for (var i=0;i < csvdata.length;i++)
            { 
                //How many destinations are possible?
                //Do we read them from a different file? 
                //One arc for 1000's of migrants, or just 1 per country?
                
                //only USA, CAN has test data now
                if ((csvdata[i].id == "USA")||(csvdata[i].id == "CAN"))
                {
                    //Push every entry onto our array
                    testArcs.push({
                    origin: {
                        latitude: csvdata[i].latStart,
                        longitude: csvdata[i].longStart
                    },
                    destination: {
                        latitude: csvdata[i].lat1,
                        longitude: csvdata[i].long1 
                    }
                    });
                }
            }
       });
          
    d3.selectAll("input").on("change", function change() {
					value = this.value;
                    console.log(value);
                    buttonClick();
    });
         
    function buttonClick()
    {
        //Draw the arcs
        map2.arc( testArcs, {strokeWidth: 2}); 
        
        //testValue
        console.log("Inside buttonClick");
        console.log(value);
        
        document.getElementById('testValue').innerHTML = "Showing year:" + value;
        
        //TODO: Set countries, filldata, call updateCloropleth to update map
        //TODO: Read the values for each year. (crisis data)
        //TODO: Reload the arcs for that year
        
        switch(value){
                
            case '1990':
                console.log("Inside case 1990");
                map.updateChoropleth({
            USA: 'red',
            CAN: '#f0af0a'
            });
                break;
            case '1995':
                console.log("Inside case 1990");
                map.updateChoropleth({
            USA: '#f0af0a',
            CAN: 'red'
            });
                break;
            default:
                console.log("Inside switch");
                console.log(value);
                break;
            }             
    }
         
     </script>
</body>
